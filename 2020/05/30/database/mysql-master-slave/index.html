<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/articles/img/favicon.png"><title>MySQL 主从复制</title><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/articles/atom.xml" title="Articles" type="application/atom+xml">
</head><body>　　<div class="inner"><h2>MySQL 主从复制</h2><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>更新 master 上的 /etc/mysql/m.cnf 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log-bin&#x3D;mysql-bin #开启二进制日志</span><br><span class="line">server-id&#x3D;1 #设置server-id</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">identified</span> <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">replication</span> <span class="keyword">slave</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span> master_host=<span class="string">&#x27;192.168.0.82&#x27;</span>,master_port=<span class="number">32795</span>, master_user=<span class="string">&#x27;repl&#x27;</span>, master_password=<span class="string">&#x27;password&#x27;</span>, master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos=<span class="number">1413</span>, master_connect_retry=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span> master_host=<span class="string">&#x27;172.17.0.3&#x27;</span>, master_user=<span class="string">&#x27;repl&#x27;</span>, master_password=<span class="string">&#x27;password&#x27;</span>, master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos=<span class="number">825</span>, master_connect_retry=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- message: Authentication plugin &#x27;caching_sha2_password&#x27; reported error: Authentication requires secure connection</span></span><br><span class="line"><span class="comment">-- change the encryption of password</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;yourusername&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;youpassword&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>可以指定同步的数据库和表以及日志的保存时间。</p>
<h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><p>无论主从还是双主，slave 需要通过固定 ip 访问到 master 服务器。因此，需要设置本地 master 的 bin log 的持续时间，并在该时间内让远程的 slave 连接到本地的 master 进行同步。</p>
<p>腾讯云的 saas 的 mysql 服务没法配置主从备份。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gl-developer/p/6170423.html">博客园文章</a></p>
<hr><p><span>↶ </span><a href="/">返回首页</a><span></span></p></div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>